<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <title>CRRE Audit Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
</head>
<body class="bg-gray-100 font-sans">
    <div id="login-container" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-600 to-gray-500 relative overflow-hidden">
        <div class="absolute inset-0 bg-[radial-gradient(circle,rgba(255,255,255,0.05)_2px,transparent_2px)] bg-[length:20px_20px] opacity-30"></div>
        <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md border-2 border-blue-600 animate-[fadeIn_0.5s_ease-in-out]">
            <h1 class="text-2xl font-bold text-gray-800 mb-2 animate-[bounceIn_0.6s_ease-in-out]">CRRE Audit Dashboard</h1>
            <p class="text-gray-500 mb-6">Sign in to access your dashboard</p>
            <div>
                <div class="relative mb-6">
                    <input type="email" id="email" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-200 transition-transform focus:scale-[1.02] peer" placeholder=" " required>
                    <label for="email" class="absolute left-3 top-3 text-gray-500 transition-all duration-200 peer-focus:-top-2 peer-focus:text-sm peer-focus:text-blue-600 peer-focus:bg-white peer-focus:px-1 peer-not-placeholder-shown:-top-2 peer-not-placeholder-shown:text-sm peer-not-placeholder-shown:bg-white peer-not-placeholder-shown:px-1">Email</label>
                </div>
                <div class="relative mb-6">
                    <input type="password" id="password" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-200 transition-transform focus:scale-[1.02] peer" placeholder=" " required>
                    <label for="password" class="absolute left-3 top-3 text-gray-500 transition-all duration-200 peer-focus:-top-2 peer-focus:text-sm peer-focus:text-blue-600 peer-focus:bg-white peer-focus:px-1 peer-not-placeholder-shown:-top-2 peer-not-placeholder-shown:text-sm peer-not-placeholder-shown:bg-white peer-not-placeholder-shown:px-1">Password</label>
                </div>
                <p id="error" class="text-red-600 text-center mb-4 text-sm hidden"></p>
                <button onclick="handleLogin()" class="w-full p-3 bg-red-600 text-white rounded-lg hover:bg-red-100 hover:text-red-600 transition-transform hover:scale-105 relative overflow-hidden group">
                    Sign In
                    <span class="absolute inset-0 bg-white opacity-30 rounded-full scale-0 group-active:scale-[2] group-active:opacity-0 transition-transform duration-400"></span>
                </button>
            </div>
        </div>
    </div>
    <div id="dashboard" class="flex min-h-screen hidden">
        <div class="w-60 bg-gray-800 text-white p-5 shadow-lg">
            <h2 class="text-xl font-semibold mb-5">CRRE Dashboard</h2>
            <ul class="space-y-2">
                <li><button onclick="showSection('dashboard-section')" class="w-full py-3 px-4 bg-gray-600 text-white rounded-md hover:bg-blue-600 transition-colors text-left active:bg-blue-600">Dashboard</button></li>
                <li><button onclick="showSection('archive-section')" class="w-full py-3 px-4 bg-gray-600 text-white rounded-md hover:bg-blue-600 transition-colors text-left">Archive</button></li>
                <li><button onclick="showSection('audit-5s')" class="w-full py-3 px-4 bg-gray-600 text-white rounded-md hover:bg-blue-600 transition-colors text-left">Audit 5S</button></li>
                <li><button onclick="showSection('audit-gemba')" class="w-full py-3 px-4 bg-gray-600 text-white rounded-md hover:bg-blue-600 transition-colors text-left">Audit Gemba</button></li>
                <li><button onclick="showSection('emplissage-tableau')" class="w-full py-3 px-4 bg-gray-600 text-white rounded-md hover:bg-blue-600 transition-colors text-left">TAU Emplissage Tableau de Bord</button></li>
                <li><button onclick="showSection('taux-absenteisme')" class="w-full py-3 px-4 bg-gray-600 text-white rounded-md hover:bg-blue-600 transition-colors text-left">Taux Absenteisme</button></li>
                <li><button onclick="showSection('taux-realisation-gemba')" class="w-full py-3 px-4 bg-gray-600 text-white rounded-md hover:bg-blue-600 transition-colors text-left">Taux Realisation Gemba</button></li>
                <li><button onclick="showSection('taux-realisation-5s')" class="w-full py-3 px-4 bg-gray-600 text-white rounded-md hover:bg-blue-600 transition-colors text-left">Taux Realisation 5S</button></li>
                <li><button onclick="showSection('top-action-gemba')" class="w-full py-3 px-4 bg-gray-600 text-white rounded-md hover:bg-blue-600 transition-colors text-left">Top Action Gemba</button></li>
                <li><button onclick="showSection('top-action-5s')" class="w-full py-3 px-4 bg-gray-600 text-white rounded-md hover:bg-blue-600 transition-colors text-left">Top Action 5S</button></li>
                <li><button onclick="handleLogout()" class="w-full py-3 px-4 bg-gray-600 text-white rounded-md hover:bg-blue-600 transition-colors text-left">Logout</button></li>
            </ul>
        </div>
        <div class="flex-1 p-8 bg-white">
            <div id="dashboard-section" class="section">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Dashboard</h2>
                <div class="flex flex-wrap gap-4 mb-8 bg-white p-5 rounded-lg shadow-md">
                    <div class="flex-1 min-w-[200px]">
                        <label for="filter-uap" class="block text-sm font-medium text-gray-700 mb-2">Filter by UAP</label>
                        <input type="text" id="filter-uap" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" placeholder="Enter UAP">
                    </div>
                    <div class="flex-1 min-w-[200px]">
                        <label for="filter-week" class="block text-sm font-medium text-gray-700 mb-2">Filter by Week</label>
                        <input type="number" id="filter-week" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" placeholder="Enter Week">
                    </div>
                    <div class="flex-1 min-w-[200px]">
                        <label for="filter-date" class="block text-sm font-medium text-gray-700 mb-2">Filter by Date</label>
                        <input type="date" id="filter-date" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="flex-1 min-w-[200px]">
                        <label for="filter-line" class="block text-sm font-medium text-gray-700 mb-2">Filter by Line</label>
                        <select id="filter-line" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 bg-[url('data:image/svg+xml;utf8,<svg fill=%27black%27 height=%2724%27 viewBox=%270 0 24 24%27 width=%2724%27 xmlns=%27http://www.w3.org/2000/svg%27><path d=%27M7 10l5 5 5-5z%27/><path d=%27M0 0h24v24H0z%27 fill=%27none%27/></svg>')] bg-no-repeat bg-[length:20px] bg-[right_0.5rem_center]">
                            <option value="" disabled selected>Select Line</option>
                            <option value="F01">F01</option>
                            <option value="F02">F02</option>
                            <option value="F99">F99</option>
                            <option value="F83">F83</option>
                            <option value="F86">F86</option>
                            <option value="F85">F85</option>
                            <option value="L76">L76</option>
                            <option value="L77">L77</option>
                            <option value="Mure qualite">Mure qualite</option>
                            <option value="magasinP2">magasinP2</option>
                            <option value="Magasin P1">Magasin P1</option>
                            <option value="magasin general">magasin general</option>
                            <option value="L84">L84</option>
                            <option value="F87">F87</option>
                            <option value="F27">F27</option>
                            <option value="F73">F73</option>
                            <option value="F15">F15</option>
                            <option value="skoda">skoda</option>
                            <option value="L101">L101</option>
                            <option value="L108">L108</option>
                            <option value="A12">A12</option>
                            <option value="F06">F06</option>
                            <option value="50 T">50 T</option>
                            <option value="80T">80T</option>
                            <option value="120T">120T</option>
                            <option value="125T">125T</option>
                            <option value="520T">520T</option>
                            <option value="400T">400T</option>
                            <option value="420T">420T</option>
                            <option value="Boy2">Boy2</option>
                            <option value="Boy3">Boy3</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button onclick="applyFilters()" class="p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Apply Filters</button>
                    </div>
                </div>
                <div class="mb-10 bg-white p-5 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-800 text-center mb-4">Audit 5S</h3>
                    <canvas id="chart-audit-5s"></canvas>
                </div>
                <div class="mb-10 bg-white p-5 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-800 text-center mb-4">Audit Gemba</h3>
                    <canvas id="chart-audit-gemba"></canvas>
                </div>
                <div class="mb-10 bg-white p-5 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-800 text-center mb-4">TAU Emplissage Tableau de Bord</h3>
                    <canvas id="chart-emplissage-tableau"></canvas>
                </div>
                <div class="mb-10 bg-white p-5 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-800 text-center mb-4">Taux Absenteisme</h3>
                    <canvas id="chart-taux-absenteisme"></canvas>
                </div>
                <div class="mb-10 bg-white p-5 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-800 text-center mb-4">Taux Realisation Gemba</h3>
                    <canvas id="chart-taux-realisation-gemba"></canvas>
                </div>
                <div class="mb-10 bg-white p-5 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-800 text-center mb-4">Taux Realisation 5S</h3>
                    <canvas id="chart-taux-realisation-5s"></canvas>
                </div>
                <div class="mb-10 bg-white p-5 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Top Action Gemba</h3>
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="p-3 text-left text-gray-800 font-semibold">Timestamp</th>
                                <th class="p-3 text-left text-gray-800 font-semibold">Line</th>
                                <th class="p-3 text-left text-gray-800 font-semibold">Action 1</th>
                                <th class="p-3 text-left text-gray-800 font-semibold">Action 2</th>
                                <th class="p-3 text-left text-gray-800 font-semibold">Action 3</th>
                                <th class="p-3 text-left text-gray-800 font-semibold">Action 4</th>
                                <th class="p-3 text-left text-gray-800 font-semibold">Action 5</th>
                            </tr>
                        </thead>
                        <tbody id="top-action-gemba-table"></tbody>
                    </table>
                </div>
                <div class="mb-10 bg-white p-5 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Top Action 5S</h3>
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="p-3 text-left text-gray-800 font-semibold">Timestamp</th>
                                <th class="p-3 text-left text-gray-800 font-semibold">Line</th>
                                <th class="p-3 text-left text-gray-800 font-semibold">Action 1</th>
                                <th class="p-3 text-left text-gray-800 font-semibold">Action 2</th>
                                <th class="p-3 text-left text-gray-800 font-semibold">Action 3</th>
                                <th class="p-3 text-left text-gray-800 font-semibold">Action 4</th>
                                <th class="p-3 text-left text-gray-800 font-semibold">Action 5</th>
                            </tr>
                        </thead>
                        <tbody id="top-action-5s-table"></tbody>
                    </table>
                </div>
            </div>
            <div id="archive-section" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Archive</h2>
                <table class="w-full border-collapse bg-white rounded-lg shadow-md">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="p-3 text-left text-gray-800 font-semibold">Section</th>
                            <th class="p-3 text-left text-gray-800 font-semibold">Timestamp</th>
                            <th class="p-3 text-left text-gray-800 font-semibold">Key Data</th>
                            <th class="p-3 text-left text-gray-800 font-semibold">UAP</th>
                            <th class="p-3 text-left text-gray-800 font-semibold">Week</th>
                            <th class="p-3 text-left text-gray-800 font-semibold">Date</th>
                            <th class="p-3 text-left text-gray-800 font-semibold">Line</th>
                            <th class="p-3 text-left text-gray-800 font-semibold">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="archive-table-body"></tbody>
                </table>
            </div>
            <div id="audit-5s" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Audit 5S</h2>
                <div class="space-y-4">
                    <div>
                        <label for="audit-5s-date" class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                        <input type="date" id="audit-5s-date" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label for="audit-5s-week" class="block text-sm font-medium text-gray-700 mb-2">Week</label>
                        <input type="number" id="audit-5s-week" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required min="1">
                    </div>
                    <div>
                        <label for="audit-5s-line" class="block text-sm font-medium text-gray-700 mb-2">Line</label>
                        <select id="audit-5s-line" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 bg-[url('data:image/svg+xml;utf8,<svg fill=%27black%27 height=%2724%27 viewBox=%270 0 24 24%27 width=%2724%27 xmlns=%27http://www.w3.org/2000/svg%27><path d=%27M7 10l5 5 5-5z%27/><path d=%27M0 0h24v24H0z%27 fill=%27none%27/></svg>')] bg-no-repeat bg-[length:20px] bg-[right_0.5rem_center]" required>
                            <option value="" disabled selected>Select Line</option>
                            <option value="F01">F01</option>
                            <option value="F02">F02</option>
                            <option value="F99">F99</option>
                            <option value="F83">F83</option>
                            <option value="F86">F86</option>
                            <option value="F85">F85</option>
                            <option value="L76">L76</option>
                            <option value="L77">L77</option>
                            <option value="Mure qualite">Mure qualite</option>
                            <option value="magasinP2">magasinP2</option>
                            <option value="Magasin P1">Magasin P1</option>
                            <option value="magasin general">magasin general</option>
                            <option value="L84">L84</option>
                            <option value="F87">F87</option>
                            <option value="F27">F27</option>
                            <option value="F73">F73</option>
                            <option value="F15">F15</option>
                            <option value="skoda">skoda</option>
                            <option value="L101">L101</option>
                            <option value="L108">L108</option>
                            <option value="A12">A12</option>
                            <option value="F06">F06</option>
                            <option value="50 T">50 T</option>
                            <option value="80T">80T</option>
                            <option value="120T">120T</option>
                            <option value="125T">125T</option>
                            <option value="520T">520T</option>
                            <option value="400T">400T</option>
                            <option value="420T">420T</option>
                            <option value="Boy2">Boy2</option>
                            <option value="Boy3">Boy3</option>
                        </select>
                    </div>
                    <div>
                        <label for="audit-5s-uap" class="block text-sm font-medium text-gray-700 mb-2">UAP</label>
                        <select id="audit-5s-uap" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 bg-[url('data:image/svg+xml;utf8,<svg fill=%27black%27 height=%2724%27 viewBox=%270 0 24 24%27 width=%2724%27 xmlns=%27http://www.w3.org/2000/svg%27><path d=%27M7 10l5 5 5-5z%27/><path d=%27M0 0h24v24H0z%27 fill=%27none%27/></svg>')] bg-no-repeat bg-[length:20px] bg-[right_0.5rem_center]" required>
                            <option value="" disabled selected>Select UAP</option>
                            <option value="UAP1">UAP1</option>
                            <option value="UAP2">UAP2</option>
                        </select>
                    </div>
                    <div>
                        <label for="audit-5s-result" class="block text-sm font-medium text-gray-700 mb-2">Result (%)</label>
                        <input type="number" id="audit-5s-result" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required min="0" max="100">
                    </div>
                    <button onclick="submitForm('Audit 5S', ['audit-5s-date', 'audit-5s-week', 'audit-5s-line', 'audit-5s-uap', 'audit-5s-result'])" class="p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Submit</button>
                </div>
            </div>
            <div id="audit-gemba" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Audit Gemba</h2>
                <div class="space-y-4">
                    <div>
                        <label for="audit-gemba-date" class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                        <input type="date" id="audit-gemba-date" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label for="audit-gemba-week" class="block text-sm font-medium text-gray-700 mb-2">Week</label>
                        <input type="number" id="audit-gemba-week" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required min="1">
                    </div>
                    <div>
                        <label for="audit-gemba-line" class="block text-sm font-medium text-gray-700 mb-2">Line</label>
                        <select id="audit-gemba-line" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 bg-[url('data:image/svg+xml;utf8,<svg fill=%27black%27 height=%2724%27 viewBox=%270 0 24 24%27 width=%2724%27 xmlns=%27http://www.w3.org/2000/svg%27><path d=%27M7 10l5 5 5-5z%27/><path d=%27M0 0h24v24H0z%27 fill=%27none%27/></svg>')] bg-no-repeat bg-[length:20px] bg-[right_0.5rem_center]" required>
                            <option value="" disabled selected>Select Line</option>
                            <option value="F01">F01</option>
                            <option value="F02">F02</option>
                            <option value="F99">F99</option>
                            <option value="F83">F83</option>
                            <option value="F86">F86</option>
                            <option value="F85">F85</option>
                            <option value="L76">L76</option>
                            <option value="L77">L77</option>
                            <option value="Mure qualite">Mure qualite</option>
                            <option value="magasinP2">magasinP2</option>
                            <option value="Magasin P1">Magasin P1</option>
                            <option value="magasin general">magasin general</option>
                            <option value="L84">L84</option>
                            <option value="F87">F87</option>
                            <option value="F27">F27</option>
                            <option value="F73">F73</option>
                            <option value="F15">F15</option>
                            <option value="skoda">skoda</option>
                            <option value="L101">L101</option>
                            <option value="L108">L108</option>
                            <option value="A12">A12</option>
                            <option value="F06">F06</option>
                            <option value="50 T">50 T</option>
                            <option value="80T">80T</option>
                            <option value="120T">120T</option>
                            <option value="125T">125T</option>
                            <option value="520T">520T</option>
                            <option value="400T">400T</option>
                            <option value="420T">420T</option>
                            <option value="Boy2">Boy2</option>
                            <option value="Boy3">Boy3</option>
                        </select>
                    </div>
                    <div>
                        <label for="audit-gemba-uap" class="block text-sm font-medium text-gray-700 mb-2">UAP</label>
                        <select id="audit-gemba-uap" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 bg-[url('data:image/svg+xml;utf8,<svg fill=%27black%27 height=%2724%27 viewBox=%270 0 24 24%27 width=%2724%27 xmlns=%27http://www.w3.org/2000/svg%27><path d=%27M7 10l5 5 5-5z%27/><path d=%27M0 0h24v24H0z%27 fill=%27none%27/></svg>')] bg-no-repeat bg-[length:20px] bg-[right_0.5rem_center]" required>
                            <option value="" disabled selected>Select UAP</option>
                            <option value="UAP1">UAP1</option>
                            <option value="UAP2">UAP2</option>
                        </select>
                    </div>
                    <div>
                        <label for="audit-gemba-result" class="block text-sm font-medium text-gray-700 mb-2">Result (%)</label>
                        <input type="number" id="audit-gemba-result" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required min="0" max="100">
                    </div>
                    <button onclick="submitForm('Audit Gemba', ['audit-gemba-date', 'audit-gemba-week', 'audit-gemba-line', 'audit-gemba-uap', 'audit-gemba-result'])" class="p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Submit</button>
                </div>
            </div>
            <div id="emplissage-tableau" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">TAU Emplissage Tableau de Bord</h2>
                <div class="space-y-4">
                    <div>
                        <label for="emplissage-date" class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                        <input type="date" id="emplissage-date" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label for="emplissage-week" class="block text-sm font-medium text-gray-700 mb-2">Week</label>
                        <input type="number" id="emplissage-week" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required min="1">
                    </div>
                    <div>
                        <label for="emplissage-line" class="block text-sm font-medium text-gray-700 mb-2">Line</label>
                        <select id="emplissage-line" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 bg-[url('data:image/svg+xml;utf8,<svg fill=%27black%27 height=%2724%27 viewBox=%270 0 24 24%27 width=%2724%27 xmlns=%27http://www.w3.org/2000/svg%27><path d=%27M7 10l5 5 5-5z%27/><path d=%27M0 0h24v24H0z%27 fill=%27none%27/></svg>')] bg-no-repeat bg-[length:20px] bg-[right_0.5rem_center]" required>
                            <option value="" disabled selected>Select Line</option>
                            <option value="F01">F01</option>
                            <option value="F02">F02</option>
                            <option value="F99">F99</option>
                            <option value="F83">F83</option>
                            <option value="F86">F86</option>
                            <option value="F85">F85</option>
                            <option value="L76">L76</option>
                            <option value="L77">L77</option>
                            <option value="Mure qualite">Mure qualite</option>
                            <option value="magasinP2">magasinP2</option>
                            <option value="Magasin P1">Magasin P1</option>
                            <option value="magasin general">magasin general</option>
                            <option value="L84">L84</option>
                            <option value="F87">F87</option>
                            <option value="F27">F27</option>
                            <option value="F73">F73</option>
                            <option value="F15">F15</option>
                            <option value="skoda">skoda</option>
                            <option value="L101">L101</option>
                            <option value="L108">L108</option>
                            <option value="A12">A12</option>
                            <option value="F06">F06</option>
                            <option value="50 T">50 T</option>
                            <option value="80T">80T</option>
                            <option value="120T">120T</option>
                            <option value="125T">125T</option>
                            <option value="520T">520T</option>
                            <option value="400T">400T</option>
                            <option value="420T">420T</option>
                            <option value="Boy2">Boy2</option>
                            <option value="Boy3">Boy3</option>
                        </select>
                    </div>
                    <div>
                        <label for="emplissage-uap" class="block text-sm font-medium text-gray-700 mb-2">UAP</label>
                        <select id="emplissage-uap" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 bg-[url('data:image/svg+xml;utf8,<svg fill=%27black%27 height=%2724%27 viewBox=%270 0 24 24%27 width=%2724%27 xmlns=%27http://www.w3.org/2000/svg%27><path d=%27M7 10l5 5 5-5z%27/><path d=%27M0 0h24v24H0z%27 fill=%27none%27/></svg>')] bg-no-repeat bg-[length:20px] bg-[right_0.5rem_center]" required>
                            <option value="" disabled selected>Select UAP</option>
                            <option value="UAP1">UAP1</option>
                            <option value="UAP2">UAP2</option>
                        </select>
                    </div>
                    <div>
                        <label for="emplissage-percentage" class="block text-sm font-medium text-gray-700 mb-2">Pourcentage</label>
                        <input type="number" id="emplissage-percentage" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required min="0" max="100">
                    </div>
                    <div>
                        <label for="emplissage-commentaire" class="block text-sm font-medium text-gray-700 mb-2">Commentaire (Optional)</label>
                        <textarea id="emplissage-commentaire" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 resize-y min-h-[100px]"></textarea>
                    </div>
                    <button onclick="submitForm('Emplissage Tableau de Bord', ['emplissage-date', 'emplissage-week', 'emplissage-line', 'emplissage-uap', 'emplissage-percentage', 'emplissage-commentaire'])" class="p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Submit</button>
                </div>
            </div>
            <div id="taux-absenteisme" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Taux Absenteisme</h2>
                <div class="space-y-4">
                    <div>
                        <label for="absenteisme-date" class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                        <input type="date" id="absenteisme-date" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label for="absenteisme-name" class="block text-sm font-medium text-gray-700 mb-2">Name</label>
                        <select id="absenteisme-name" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 bg-[url('data:image/svg+xml;utf8,<svg fill=%27black%27 height=%2724%27 viewBox=%270 0 24 24%27 width=%2724%27 xmlns=%27http://www.w3.org/2000/svg%27><path d=%27M7 10l5 5 5-5z%27/><path d=%27M0 0h24v24H0z%27 fill=%27none%27/></svg>')] bg-no-repeat bg-[length:20px] bg-[right_0.5rem_center]" required>
                            <option value="" disabled selected>Select Name</option>
                            <option value="Ahmed KHAMESI">Ahmed KHAMESI</option>
                            <option value="Anis YAHYAOUI">Anis YAHYAOUI</option>
                            <option value="Chemsi Mohamed">Chemsi Mohamed</option>
                            <option value="Maugendre Jérémie">Maugendre Jérémie</option>
                            <option value="Gargouri Mohamed Amine">Gargouri Mohamed Amine</option>
                            <option value="Hafaiedh Sami">Hafaiedh Sami</option>
                            <option value="Tarek Jaouada">Tarek Jaouada</option>
                            <option value="Sghair Bedis">Sghair Bedis</option>
                            <option value="Amine Aloui">Amine Aloui</option>
                            <option value="Chakroun Sahbi">Chakroun Sahbi</option>
                        </select>
                    </div>
                    <div>
                        <label for="absenteisme-week" class="block text-sm font-medium text-gray-700 mb-2">Week</label>
                        <input type="number" id="absenteisme-week" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required min="1">
                    </div>
                    <div>
                        <label for="absenteisme-status" class="block text-sm font-medium text-gray-700 mb-2">Status (1 = Present, 0 = Absent)</label>
                        <select id="absenteisme-status" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 bg-[url('data:image/svg+xml;utf8,<svg fill=%27black%27 height=%2724%27 viewBox=%270 0 24 24%27 width=%2724%27 xmlns=%27http://www.w3.org/2000/svg%27><path d=%27M7 10l5 5 5-5z%27/><path d=%27M0 0h24v24H0z%27 fill=%27none%27/></svg>')] bg-no-repeat bg-[length:20px] bg-[right_0.5rem_center]" required>
                            <option value="" disabled selected>Select Status</option>
                            <option value="1">Present</option>
                            <option value="0">Absent</option>
                        </select>
                    </div>
                    <button onclick="submitForm('Taux Absenteisme', ['absenteisme-date', 'absenteisme-name', 'absenteisme-week', 'absenteisme-status'])" class="p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Submit</button>
                </div>
            </div>
            <div id="taux-realisation-gemba" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Taux Realisation Audit Gemba</h2>
                <div class="space-y-4">
                    <div>
                        <label for="realisation-gemba-audits" class="block text-sm font-medium text-gray-700 mb-2">Number of Audits per Week</label>
                        <input type="number" id="realisation-gemba-audits" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required min="1">
                    </div>
                    <div>
                        <label for="realisation-gemba-week" class="block text-sm font-medium text-gray-700 mb-2">Week</label>
                        <input type="number" id="realisation-gemba-week" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required min="1">
                    </div>
                    <div>
                        <label for="realisation-gemba-realised" class="block text-sm font-medium text-gray-700 mb-2">Number of Audits Realised</label>
                        <input type="number" id="realisation-gemba-realised" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required min="0">
                    </div>
                    <button onclick="submitForm('Taux Realisation Gemba', ['realisation-gemba-audits', 'realisation-gemba-week', 'realisation-gemba-realised'])" class="p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Submit</button>
                </div>
            </div>
            <div id="taux-realisation-5s" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Taux Realisation 5S</h2>
                <div class="space-y-4">
                    <div>
                        <label for="realisation-5s-audits" class="block text-sm font-medium text-gray-700 mb-2">Number of Audits per Week</label>
                        <input type="number" id="realisation-5s-audits" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required min="1">
                    </div>
                    <div>
                        <label for="realisation-5s-week" class="block text-sm font-medium text-gray-700 mb-2">Week</label>
                        <input type="number" id="realisation-5s-week" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required min="1">
                    </div>
                    <div>
                        <label for="realisation-5s-realised" class="block text-sm font-medium text-gray-700 mb-2">Number of Audits Realised</label>
                        <input type="number" id="realisation-5s-realised" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required min="0">
                    </div>
                    <button onclick="submitForm('Taux Realisation 5S', ['realisation-5s-audits', 'realisation-5s-week', 'realisation-5s-realised'])" class="p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Submit</button>
                </div>
            </div>
            <div id="top-action-gemba" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Top Action Gemba</h2>
                <div class="space-y-4">
                    <div>
                        <label for="top-gemba-line" class="block text-sm font-medium text-gray-700 mb-2">Line</label>
                        <input type="text" id="top-gemba-line" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label for="top-gemba-action1" class="block text-sm font-medium text-gray-700 mb-2">Action 1 (Optional)</label>
                        <input type="text" id="top-gemba-action1" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label for="top-gemba-action2" class="block text-sm font-medium text-gray-700 mb-2">Action 2 (Optional)</label>
                        <input type="text" id="top-gemba-action2" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label for="top-gemba-action3" class="block text-sm font-medium text-gray-700 mb-2">Action 3 (Optional)</label>
                        <input type="text" id="top-gemba-action3" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label for="top-gemba-action4" class="block text-sm font-medium text-gray-700 mb-2">Action 4 (Optional)</label>
                        <input type="text" id="top-gemba-action4" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label for="top-gemba-action5" class="block text-sm font-medium text-gray-700 mb-2">Action 5 (Optional)</label>
                        <input type="text" id="top-gemba-action5" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <button onclick="submitForm('Top Action Gemba', ['top-gemba-line', 'top-gemba-action1', 'top-gemba-action2', 'top-gemba-action3', 'top-gemba-action4', 'top-gemba-action5'])" class="p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Submit</button>
                </div>
            </div>
            <div id="top-action-5s" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Top Action 5S</h2>
                <div class="space-y-4">
                    <div>
                        <label for="top-5s-line" class="block text-sm font-medium text-gray-700 mb-2">Line</label>
                        <input type="text" id="top-5s-line" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label for="top-5s-action1" class="block text-sm font-medium text-gray-700 mb-2">Action 1 (Optional)</label>
                        <input type="text" id="top-5s-action1" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label for="top-5s-action2" class="block text-sm font-medium text-gray-700 mb-2">Action 2 (Optional)</label>
                        <input type="text" id="top-5s-action2" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label for="top-5s-action3" class="block text-sm font-medium text-gray-700 mb-2">Action 3 (Optional)</label>
                        <input type="text" id="top-5s-action3" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label for="top-5s-action4" class="block text-sm font-medium text-gray-700 mb-2">Action 4 (Optional)</label>
                        <input type="text" id="top-5s-action4" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label for="top-5s-action5" class="block text-sm font-medium text-gray-700 mb-2">Action 5 (Optional)</label>
                        <input type="text" id="top-5s-action5" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <button onclick="submitForm('Top Action 5S', ['top-5s-line', 'top-5s-action1', 'top-5s-action2', 'top-5s-action3', 'top-5s-action4', 'top-5s-action5'])" class="p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Submit</button>
                </div>
            </div>
        </div>
        <div id="details-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
            <div class="bg-white p-5 rounded-lg max-w-md w-full max-h-[80vh] overflow-y-auto">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Submission Details</h3>
                <pre id="modal-details" class="bg-gray-50 p-3 rounded-md overflow-x-auto"></pre>
                <button onclick="closeModal()" class="p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors mt-4">Close</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Import Firebase SDK
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, getDoc, deleteDoc, query, where } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyARc68C9RvqPHedrAtxJcZCUeZIEfn1XnA",
            authDomain: "dashbord-10e83.firebaseapp.com",
            projectId: "dashbord-10e83",
            storageBucket: "dashbord-10e83.firebasestorage.app",
            messagingSenderId: "1060154426951",
            appId: "1:1060154426951:web:121e08b5f1ec5323f49362",
            measurementId: "G-97L4PN4Q0P"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let chartInstances = {};

        // Handle authentication state
        onAuthStateChanged(auth, user => {
            console.log('Auth state:', user ? `User ${user.uid} (${user.email})` : 'No user');
            if (user) {
                document.getElementById('login-container').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                showSection('dashboard-section');
            } else {
                document.getElementById('login-container').classList.remove('hidden');
                document.getElementById('dashboard').classList.add('hidden');
            }
        });

        window.handleLogin = function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const error = document.getElementById('error');

            signInWithEmailAndPassword(auth, email, password)
                .then(() => {
                    error.classList.add('hidden');
                })
                .catch(err => {
                    error.textContent = err.message;
                    error.classList.remove('hidden');
                });
        };

        window.handleLogout = function() {
            signOut(auth)
                .catch(err => {
                    alert('Error logging out: ' + err.message);
                });
        };

        window.showSection = function(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');

            document.querySelectorAll('.sidebar button').forEach(button => {
                button.classList.remove('active:bg-blue-600');
                button.classList.add('bg-gray-600');
            });
            const activeButton = document.querySelector(`button[onclick="showSection('${sectionId}')"]`);
            activeButton.classList.remove('bg-gray-600');
            activeButton.classList.add('active:bg-blue-600');

            if (sectionId === 'dashboard-section') {
                applyFilters();
            } else if (sectionId === 'archive-section') {
                updateArchiveTable();
            }
        };

        window.submitForm = async function(sectionName, inputIds) {
            try {
                const user = auth.currentUser;
                if (!user) {
                    alert('Please log in to submit data.');
                    document.getElementById('login-container').classList.remove('hidden');
                    document.getElementById('dashboard').classList.add('hidden');
                    return;
                }
                const formData = { 
                    section: sectionName, 
                    timestamp: new Date().toISOString(),
                    userId: user.uid 
                };
                inputIds.forEach(id => {
                    const value = document.getElementById(id).value;
                    formData[id] = value === null || value === undefined ? '' : String(value).replace(/[^\x20-\x7E]/g, '');
                });

                console.log('Submitting formData:', formData);
                await addDoc(collection(db, 'submissions'), formData);
                alert(`${sectionName} submitted successfully`);

                document.querySelectorAll(`#${sectionName.toLowerCase().replace(/\s+/g, '-')}-section input, #${sectionName.toLowerCase().replace(/\s+/g, '-')}-section textarea, #${sectionName.toLowerCase().replace(/\s+/g, '-')}-section select`).forEach(input => {
                    input.value = '';
                });

                applyFilters();
                if (!document.getElementById('archive-section').classList.contains('hidden')) {
                    updateArchiveTable();
                }
            } catch (err) {
                console.error('Submit error:', err);
                alert('Error submitting form: ' + err.message);
            }
        };

        function getBarColor(value) {
            if (value >= 85) return 'rgba(75, 192, 192, 0.8)';
            if (value >= 75) return 'rgba(255, 159, 64, 0.8)';
            return 'rgba(255, 99, 132, 0.8)';
        }

        window.applyFilters = async function() {
            const filterUAP = document.getElementById('filter-uap').value.toLowerCase();
            const filterWeek = document.getElementById('filter-week').value;
            const filterDate = document.getElementById('filter-date').value;
            const filterLine = document.getElementById('filter-line').value;

            try {
                const user = auth.currentUser;
                if (!user) {
                    alert('Please log in to view data.');
                    return;
                }
                const q = query(collection(db, 'submissions'), where('userId', '==', user.uid));
                const submissions = [];

                console.log('Applying filters:', { filterUAP, filterWeek, filterDate, filterLine });

                const snapshot = await getDocs(q);
                snapshot.forEach(doc => {
                    const data = { id: doc.id, ...doc.data() };
                    let matchesUAP = true;
                    let matchesWeek = true;
                    let matchesDate = true;
                    let matchesLine = true;

                    if (filterUAP) {
                        matchesUAP = (data['audit-5s-uap'] || data['audit-gemba-uap'] || data['emplissage-uap'] || '').toLowerCase().includes(filterUAP);
                    }
                    if (filterWeek) {
                        matchesWeek = (
                            data['audit-5s-week'] === filterWeek ||
                            data['audit-gemba-week'] === filterWeek ||
                            data['absenteisme-week'] === filterWeek ||
                            data['realisation-gemba-week'] === filterWeek ||
                            data['realisation-5s-week'] === filterWeek ||
                            data['emplissage-week'] === filterWeek
                        );
                    }
                    if (filterDate) {
                        matchesDate = (
                            data['audit-5s-date'] === filterDate ||
                            data['audit-gemba-date'] === filterDate ||
                            data['absenteisme-date'] === filterDate ||
                            data['emplissage-date'] === filterDate
                        );
                    }
                    if (filterLine) {
                        matchesLine = (
                            data['audit-5s-line'] === filterLine ||
                            data['audit-gemba-line'] === filterLine ||
                            data['emplissage-line'] === filterLine
                        );
                    }

                    if (matchesUAP && matchesWeek && matchesDate && matchesLine) {
                        submissions.push(data);
                    }
                });

                console.log('Filtered submissions:', submissions);
                if (submissions.length === 0) {
                    alert('No data matches the selected filters.');
                }

                updateCharts(submissions);
                updateActionTables(submissions);
            } catch (err) {
                console.error('Filter error:', err);
                alert('Error fetching submissions: ' + err.message);
            }
        };

        function updateCharts(submissions) {
            const chartConfigs = [
                {
                    id: 'chart-audit-5s',
                    label: 'Audit 5S Result (%)',
                    data: submissions
                        .filter(s => s.section === 'Audit 5S')
                        .map(s => ({
                            x: s['audit-5s-week'] || s.timestamp,
                            y: parseFloat(s['audit-5s-result']) || 0,
                            line: s['audit-5s-line'] || '-',
                            date: s['audit-5s-date'] || '-',
                            uap: s['audit-5s-uap'] || '-'
                        })),
                    key: 'audit-5s-result'
                },
                {
                    id: 'chart-audit-gemba',
                    label: 'Audit Gemba Result (%)',
                    data: submissions
                        .filter(s => s.section === 'Audit Gemba')
                        .map(s => ({
                            x: s['audit-gemba-week'] || s.timestamp,
                            y: parseFloat(s['audit-gemba-result']) || 0,
                            line: s['audit-gemba-line'] || '-',
                            date: s['audit-gemba-date'] || '-',
                            uap: s['audit-gemba-uap'] || '-'
                        })),
                    key: 'audit-gemba-result'
                },
                {
                    id: 'chart-emplissage-tableau',
                    label: 'Emplissage Tableau Pourcentage (%)',
                    data: submissions
                        .filter(s => s.section === 'Emplissage Tableau de Bord')
                        .map(s => ({
                            x: s['emplissage-week'] || s.timestamp,
                            y: parseFloat(s['emplissage-percentage']) || 0,
                            line: s['emplissage-line'] || '-',
                            date: s['emplissage-date'] || '-',
                            uap: s['emplissage-uap'] || '-'
                        })),
                    key: 'emplissage-percentage'
                },
                {
                    id: 'chart-taux-absenteisme',
                    label: 'Taux Absenteisme Status (%)',
                    data: submissions
                        .filter(s => s.section === 'Taux Absenteisme')
                        .map(s => ({
                            x: s['absenteisme-week'] || s.timestamp,
                            y: parseInt(s['absenteisme-status']) === 1 ? 100 : 0
                        })),
                    key: 'absenteisme-status'
                },
                {
                    id: 'chart-taux-realisation-gemba',
                    label: 'Taux Realisation Gemba (%)',
                    data: submissions
                        .filter(s => s.section === 'Taux Realisation Gemba')
                        .map(s => ({
                            x: s['realisation-gemba-week'] || s.timestamp,
                            y: Math.min((parseFloat(s['realisation-gemba-realised']) / parseFloat(s['realisation-gemba-audits']) * 100) || 0, 100)
                        })),
                    key: 'realisation-gemba'
                },
                {
                    id: 'chart-taux-realisation-5s',
                    label: 'Taux Realisation 5S (%)',
                    data: submissions
                        .filter(s => s.section === 'Taux Realisation 5S')
                        .map(s => ({
                            x: s['realisation-5s-week'] || s.timestamp,
                            y: Math.min((parseFloat(s['realisation-5s-realised']) / parseFloat(s['realisation-5s-audits']) * 100) || 0, 100)
                        })),
                    key: 'realisation-5s'
                }
            ];

            chartConfigs.forEach(config => {
                const ctx = document.getElementById(config.id).getContext('2d');
                if (chartInstances[config.id]) {
                    chartInstances[config.id].destroy();
                }

                const backgroundColors = config.data.map(data => getBarColor(data.y));

                chartInstances[config.id] = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: config.data.map(d => d.x),
                        datasets: [{
                            label: config.label,
                            data: config.data.map(d => d.y),
                            backgroundColor: backgroundColors,
                            borderColor: backgroundColors.map(color => color.replace('0.8', '1')),
                            borderWidth: 1,
                            customData: config.data
                        }]
                    },
                    options: {
                        scales: {
                            x: {
                                title: { display: true, text: 'Week or Timestamp' }
                            },
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: { display: true, text: 'Percentage (%)' }
                            }
                        },
                        plugins: {
                            legend: { display: true },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const data = context.dataset.customData[context.dataIndex];
                                        if (context.dataset.label.includes('Audit 5S') || context.dataset.label.includes('Audit Gemba') || context.dataset.label.includes('Emplissage')) {
                                            return [
                                                `${context.dataset.label}: ${context.raw.toFixed(2)}%`,
                                                `Line: ${data.line || '-'}`,
                                                `Date: ${data.date}`,
                                                `Week: ${data.x}`,
                                                `UAP: ${data.uap || '-'}`
                                            ];
                                        }
                                        return `${context.dataset.label}: ${context.raw.toFixed(2)}%`;
                                    }
                                }
                            }
                        }
                    }
                });
            });
        }

        function updateActionTables(submissions) {
            const gembaTbody = document.getElementById('top-action-gemba-table');
            const fiveSTbody = document.getElementById('top-action-5s-table');
            gembaTbody.innerHTML = '';
            fiveSTbody.innerHTML = '';

            const gembaSubmissions = submissions.filter(s => s.section === 'Top Action Gemba');
            const fiveSSubmissions = submissions.filter(s => s.section === 'Top Action 5S');

            gembaSubmissions.forEach(submission => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-100';
                row.innerHTML = `
                    <td class="p-3 border-b">${new Date(submission.timestamp).toLocaleString()}</td>
                    <td class="p-3 border-b">${submission['top-gemba-line'] || '-'}</td>
                    <td class="p-3 border-b">${submission['top-gemba-action1'] || '-'}</td>
                    <td class="p-3 border-b">${submission['top-gemba-action2'] || '-'}</td>
                    <td class="p-3 border-b">${submission['top-gemba-action3'] || '-'}</td>
                    <td class="p-3 border-b">${submission['top-gemba-action4'] || '-'}</td>
                    <td class="p-3 border-b">${submission['top-gemba-action5'] || '-'}</td>
                `;
                gembaTbody.appendChild(row);
            });

            fiveSSubmissions.forEach(submission => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-100';
                row.innerHTML = `
                    <td class="p-3 border-b">${new Date(submission.timestamp).toLocaleString()}</td>
                    <td class="p-3 border-b">${submission['top-5s-line'] || '-'}</td>
                    <td class="p-3 border-b">${submission['top-5s-action1'] || '-'}</td>
                    <td class="p-3 border-b">${submission['top-5s-action2'] || '-'}</td>
                    <td class="p-3 border-b">${submission['top-5s-action3'] || '-'}</td>
                    <td class="p-3 border-b">${submission['top-5s-action4'] || '-'}</td>
                    <td class="p-3 border-b">${submission['top-5s-action5'] || '-'}</td>
                `;
                fiveSTbody.appendChild(row);
            });
        }

        window.updateArchiveTable = async function() {
            const tbody = document.getElementById('archive-table-body');
            tbody.innerHTML = '';
            try {
                const user = auth.currentUser;
                if (!user) {
                    alert('Please log in to view archive.');
                    return;
                }
                const q = query(collection(db, 'submissions'), where('userId', '==', user.uid));
                const snapshot = await getDocs(q);
                snapshot.forEach(doc => {
                    const submission = { id: doc.id, ...doc.data() };
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-100';
                    const keyData = getKeyData(submission);
                    row.innerHTML = `
                        <td class="p-3 border-b">${submission.section}</td>
                        <td class="p-3 border-b">${new Date(submission.timestamp).toLocaleString()}</td>
                        <td class="p-3 border-b">${keyData}</td>
                        <td class="p-3 border-b">${submission['audit-5s-uap'] || submission['audit-gemba-uap'] || submission['emplissage-uap'] || '-'}</td>
                        <td class="p-3 border-b">${submission['audit-5s-week'] || submission['audit-gemba-week'] || submission['absenteisme-week'] || submission['realisation-gemba-week'] || submission['realisation-5s-week'] || submission['emplissage-week'] || '-'}</td>
                        <td class="p-3 border-b">${submission['audit-5s-date'] || submission['audit-gemba-date'] || submission['absenteisme-date'] || submission['emplissage-date'] || '-'}</td>
                        <td class="p-3 border-b">${submission['audit-5s-line'] || submission['audit-gemba-line'] || submission['emplissage-line'] || '-'}</td>
                        <td class="p-3 border-b">
                            <button class="px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 mr-2" onclick="viewSubmission('${submission.id}')">View</button>
                            <button class="px-3 py-2 bg-red-600 text-white rounded-md hover:bg-red-700" onclick="deleteSubmission('${submission.id}')">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (err) {
                console.error('Archive error:', err);
                alert('Error fetching archive: ' + err.message);
            }
        };

        function getKeyData(submission) {
            switch (submission.section) {
                case 'Audit 5S':
                    return `${submission['audit-5s-result']}%`;
                case 'Audit Gemba':
                    return `${submission['audit-gemba-result']}%`;
                case 'Emplissage Tableau de Bord':
                    return `${submission['emplissage-percentage']}%`;
                case 'Taux Absenteisme':
                    return submission['absenteisme-status'] === '1' ? 'Present' : 'Absent';
                case 'Taux Realisation Gemba':
                    return `${((parseFloat(submission['realisation-gemba-realised']) / parseFloat(submission['realisation-gemba-audits']) * 100) || 0).toFixed(2)}%`;
                case 'Taux Realisation 5S':
                    return `${((parseFloat(submission['realisation-5s-realised']) / parseFloat(submission['realisation-5s-audits']) * 100) || 0).toFixed(2)}%`;
                case 'Top Action Gemba':
                    return `${([submission['top-gemba-action1'], submission['top-gemba-action2'], submission['top-gemba-action3'], submission['top-gemba-action4'], submission['top-gemba-action5']].filter(a => a).length / 5 * 100).toFixed(2)}%`;
                case 'Top Action 5S':
                    return `${([submission['top-5s-action1'], submission['top-5s-action2'], submission['top-5s-action3'], submission['top-5s-action4'], submission['top-5s-action5']].filter(a => a).length / 5 * 100).toFixed(2)}%`;
                default:
                    return '-';
            }
        }

        window.viewSubmission = async function(docId) {
            try {
                const docRef = doc(db, 'submissions', docId);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    document.getElementById('modal-details').textContent = JSON.stringify({ id: docSnap.id, ...docSnap.data() }, null, 2);
                    document.getElementById('details-modal').style.display = 'flex';
                } else {
                    alert('Submission not found');
                }
            } catch (err) {
                console.error('View error:', err);
                alert('Error viewing submission: ' + err.message);
            }
        };

        window.deleteSubmission = async function(docId) {
            if (confirm('Are you sure you want to delete this submission?')) {
                try {
                    await deleteDoc(doc(db, 'submissions', docId));
                    updateArchiveTable();
                    applyFilters();
                } catch (err) {
                    console.error('Delete error:', err);
                    alert('Error deleting submission: ' + err.message);
                }
            }
        };

        window.closeModal = function() {
            document.getElementById('details-modal').style.display = 'none';
        };
    </script>
</body>
</html>
